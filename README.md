# Лабораторная 2

## Цель работы
разработка структуры базы данных и ее подключение к бэкенду

---

## Порядок показа
- Показать панель администратора Django/Adminer, в которой добавить новую услугу.  
- Посмотреть данные через `SELECT` в БД.  
- Показать 3 страницы приложения:  
  - выполнить поиск,  
  - удалить заявку,  
  - перейти по URL удаленной заявки,  
  - добавить две услуги в заявку (изменение карточки корзины),  
  - показать содержимое заявки.  
- Показать в БД запросом результаты логического удаления и новую заявку.  
- В БД изменить поля по теме в заявке и м-м, показать изменения в приложении.  
- В коде показать:  
  - модели,  
  - составной уникальный ключ м-м,  
  - 4 контроллера через ORM,  
  - удаление заявки через SQL `UPDATE`.  

---

## Контрольные вопросы
- виды БД  
- SQL-запросы  
- курсоры  
- ORM  
- модель и миграции  
- чистая архитектура  

---

## ER-диаграмма
Сделать в **StarUML**:  
- таблицы,  
- связи,  
- столбцы,  
- типы столбцов и их длина,  
- первичные и внешние ключи.  

---

## Задание
Создание базы данных **PostgreSQL** по теме работы, подключение БД к созданным трём шаблонам.  

Необходимо:  
- разработать структуру БД по выбранной теме и реализовать её с учётом требований ниже;  
- использовать таблицу услуг в страницах разработанного приложения;  
- наполнить таблицы БД данными через админку **Django** или **Adminer**.  

---

## Функционал приложения
- Получение и поиск услуг через ORM.  
- Добавление услуги в текущую заявку (**статус "черновик" = корзина**) через ORM.  
- Просмотр текущей заявки через ORM.  
- Для страницы текущей заявки добавить кнопку логического удаления заявки (смена статуса на "удалён") с помощью SQL `UPDATE` (**без ORM**).  
- Всего 5 HTTP-методов:  
  - 3 GET,  
  - 1 POST — добавление в заявку (ORM),  
  - 1 POST — удаление заявки (SQL).  

---

## Логика заявок
- При отсутствии заявки в статусе **черновик** у пользователя она создаётся автоматически при добавлении услуги.  
- Если заявка уже есть, новая услуга добавляется в неё.  
- Удалённые заявки просматривать нельзя.  
- Если у пользователя нет текущей заявки, её карточка на странице услуг **не активна**.  

---

## Требования к БД
Обязательные таблицы (**4 шт.**, каскадное удаление запрещено):  

1. **Услуги**  
   - наименование,  
   - описание,  
   - статус (удалён/действует),  
   - URL к изображению (Nullable),  
   - поля по предметной области.  

2. **Заявки**  
   - 4 обязательных поля NotNull:  
     - id,  
     - статус,  
     - дата создания (datetime),  
     - создатель.  
   - дата формирования (2 действия создателя, datetime),  
   - дата завершения (2 действия модератора, datetime),  
   - модератор,  
   - поля по предметной области.  

3. **М-м заявки-услуги**  
   - составной уникальный ключ,  
   - дополнительные поля (количество/порядок/главный/другое).  

4. **Пользователи**  
   - использовать системную таблицу Django (**НЕ свою!**)  
   - логин, пароль, признак модератора.  

---

## Статусы заявок
Обязательно наличие 5+ статусов:  
- черновик  
- удалён  
- сформирован  
- завершён  
- отклонён  

Ограничение: у каждого пользователя не более одной заявки в статусе **черновик**.  

Названия таблиц и полей должны соответствовать предметной области.  
Одно из дополнительных полей заявки или м-м рассчитывается при завершении заявки.  